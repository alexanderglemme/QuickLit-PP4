{% extends 'base.html' %}

{% block title %}Conversation{% endblock %}

{% block content %}
<div class="container-fluid">
  <div class="row">
    <div class="col-md-12 justify-content-center text-center py-4">
      <h2> 
        {{ conversation.ad.title }} | {% if request.user.get_username == conversation.members.first.get_username %} 
                                          {{ conversation.members.last.get_username }} 
                                      {% else %}
                                          {{ conversation.members.first.get_username }}
                                      {% endif %}
      </h2>
    </div>
    <hr>
  </div>
</div>
{% for message in conversation.messages.all %}
<div class="container-fluid">
  {% if request.user.get_username == message.created_by.get_username %}
  <div class="row justify-content-end">
    <div class="col-md-7">
      <div class="d-flex justify-content-end h-">
        <p class="text-muted lh-1"> <strong>{{ message.created_by.username }}</strong> at {{ message.created_at }}</p>
      </div>
      <div class="bg-primary flex-fill bd-highlight rounded">
        <p class="p-1 text-light"> {{ message.content }} </p>
      </div>
    </div>
  </div>
  {% else %}
  <div class="row justify-content-start">
    <div class="col-md-7">
      <div class="d-flex">
        <p class="text-muted lh-1"> <strong>{{ message.created_by.username }}</strong> at {{ message.created_at }}</p>
      </div>
      <div class="bg-secondary flex-fill bd-highlight rounded">
        <p class="p-1 text-light"> {{ message.content }} </p>
      </div>
    </div>
  </div>
  {% endif %}
</div>
{% endfor %}

<div>

  <form method="POST">
    {% csrf_token %}
    <div class="mb-3">
      {{ form }}
      {% for error in field.errors %}
      <div class="invalid-feedback d-block">{{ error }}</div>
      {% endfor %}
    </div>
    <button type="submit" class="btn btn-success">Send</button>
  </form>
</div>

{% endblock %}